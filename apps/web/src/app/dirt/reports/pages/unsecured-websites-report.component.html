<app-header></app-header>

<bit-container>
  <p>{{ "unsecuredWebsitesReportDesc" | i18n }}</p>
  @if (!hasLoaded && loading) {
    <div>
      <i
        class="bwi bwi-spinner bwi-spin tw-text-muted"
        title="{{ 'loading' | i18n }}"
        aria-hidden="true"
      ></i>
      <span class="tw-sr-only">{{ "loading" | i18n }}</span>
    </div>
  }
  @if (hasLoaded) {
    <div class="tw-mt-4">
      @if (!ciphers.length) {
        <bit-callout type="success" title="{{ 'goodNews' | i18n }}">
          {{ "noUnsecuredWebsites" | i18n }}
        </bit-callout>
      }
      @if (ciphers.length) {
        <bit-callout type="danger" title="{{ 'unsecuredWebsitesFound' | i18n }}">
          {{ "unsecuredWebsitesFoundReportDesc" | i18n: (ciphers.length | number) : vaultMsg }}
        </bit-callout>
        @if (showFilterToggle && !isAdminConsoleActive) {
          <bit-toggle-group
            [selected]="filterOrgStatus$ | async"
            (selectedChange)="filterOrgToggle($event)"
            [attr.aria-label]="'addAccessFilter' | i18n"
          >
            @for (status of filterStatus; track status) {
              <bit-toggle [value]="status">
                {{ getName(status) }}
                <span bitBadge variant="info"> {{ getCount(status) }} </span>
              </bit-toggle>
            }
          </bit-toggle-group>
        }
        <bit-table [dataSource]="dataSource">
          @if (!isAdminConsoleActive) {
            <ng-container header>
              <tr bitRow>
                <th bitCell></th>
                <th bitCell>{{ "name" | i18n }}</th>
                <th bitCell>{{ "owner" | i18n }}</th>
                <th bitCell></th>
              </tr>
            </ng-container>
          }
          <ng-template body let-rows$>
            <!-- prettier-ignore -->
            @for (r of (rows$ | async); track r) {
              <tr bitRow>
                <td bitCell>
                  <app-vault-icon [cipher]="r"></app-vault-icon>
                </td>
                <td bitCell>
                  @if (!organization || canManageCipher(r)) {
                    <a
                      bitLink
                      href="#"
                      appStopClick
                      (click)="selectCipher(r)"
                      title="{{ 'editItemWithName' | i18n: r.name }}"
                      >{{ r.name }}</a
                    >
                  } @else {
                    <span>{{ r.name }}</span>
                  }
                  @if (!organization && r.organizationId) {
                    <i
                      class="bwi bwi-collection-shared tw-ml-1"
                      appStopProp
                      title="{{ 'shared' | i18n }}"
                      aria-hidden="true"
                    ></i>
                    <span class="tw-sr-only">{{ "shared" | i18n }}</span>
                  }
                  @if (r.hasAttachments) {
                    <i
                      class="bwi bwi-paperclip tw-ml-1"
                      appStopProp
                      title="{{ 'attachments' | i18n }}"
                      aria-hidden="true"
                    ></i>
                    <span class="tw-sr-only">{{ "attachments" | i18n }}</span>
                  }
                  <br />
                  <small>{{ r.subTitle }}</small>
                </td>
                <td bitCell>
                  @if (!organization) {
                    <app-org-badge
                      [disabled]="disabled"
                      [organizationId]="r.organizationId"
                      [organizationName]="
                        r.organizationId | orgNameFromId: (organizations$ | async)
                      "
                      appStopProp
                    >
                    </app-org-badge>
                  }
                </td>
              </tr>
            }
          </ng-template>
        </bit-table>
      }
    </div>
  }
</bit-container>
