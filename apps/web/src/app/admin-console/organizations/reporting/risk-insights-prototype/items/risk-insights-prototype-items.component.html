<div class="tw-flex tw-flex-col tw-gap-4">
  <!-- Results Table -->
  @if (items().length > 0) {
    <div class="tw-text-sm tw-text-muted tw-mb-2">
      {{ "totalItems" | i18n }}: {{ items().length | number }}
    </div>

    <bit-table-scroll [dataSource]="dataSource" [rowSize]="ROW_SIZE" [trackBy]="trackByItemId">
      <ng-container header>
        <th bitCell class="tw-min-w-[200px]">{{ "name" | i18n }}</th>
        <th bitCell class="tw-text-center tw-w-24">{{ "weak" | i18n }}</th>
        <th bitCell class="tw-text-center tw-w-24">{{ "reused" | i18n }}</th>
        <th bitCell class="tw-text-center tw-w-24">{{ "exposed" | i18n }}</th>
        <th bitCell class="tw-text-center tw-w-24">{{ "members" | i18n }}</th>
        <th bitCell class="tw-text-center tw-w-28">{{ "status" | i18n }}</th>
      </ng-container>

      <ng-template bitRowDef let-row>
        <!-- Cipher Name -->
        <td bitCell>
          <div class="tw-font-medium tw-truncate tw-max-w-[200px]" [title]="row.cipherName">
            {{ row.cipherName }}
          </div>
          @if (row.cipherSubtitle) {
            <div class="tw-text-xs tw-text-muted tw-truncate tw-max-w-[200px]">
              {{ row.cipherSubtitle }}
            </div>
          }
        </td>

        <!-- Weak Password Status -->
        <td bitCell class="tw-text-center">
          @if (row.weakPassword === null) {
            @if (enableWeakPassword()) {
              <i
                class="bwi bwi-spinner bwi-spin tw-text-muted"
                aria-hidden="true"
                title="{{ 'loading' | i18n }}"
              ></i>
            } @else {
              <span class="tw-text-muted">-</span>
            }
          } @else if (row.weakPassword) {
            <span bitBadge variant="warning">{{ "weak" | i18n }}</span>
          } @else {
            <i class="bwi bwi-check tw-text-success-600" aria-hidden="true"></i>
          }
        </td>

        <!-- Reused Password Status -->
        <td bitCell class="tw-text-center">
          @if (row.reusedPassword === null) {
            @if (enableReusedPassword()) {
              <i
                class="bwi bwi-spinner bwi-spin tw-text-muted"
                aria-hidden="true"
                title="{{ 'loading' | i18n }}"
              ></i>
            } @else {
              <span class="tw-text-muted">-</span>
            }
          } @else if (row.reusedPassword) {
            <span bitBadge variant="warning">{{ "yes" | i18n }}</span>
          } @else {
            <i class="bwi bwi-check tw-text-success-600" aria-hidden="true"></i>
          }
        </td>

        <!-- Exposed Password Status -->
        <td bitCell class="tw-text-center">
          @if (row.exposedPassword === null) {
            @if (enableHibp()) {
              <i
                class="bwi bwi-spinner bwi-spin tw-text-muted"
                aria-hidden="true"
                title="{{ 'loading' | i18n }}"
              ></i>
            } @else {
              <span class="tw-text-muted">-</span>
            }
          } @else if (row.exposedPassword) {
            <span bitBadge variant="danger" [title]="row.exposedCount + ' times'">
              {{ row.exposedCount | number }}x
            </span>
          } @else {
            <i class="bwi bwi-check tw-text-success-600" aria-hidden="true"></i>
          }
        </td>

        <!-- Member Count -->
        <td bitCell class="tw-text-center">
          @if (row.memberAccessPending) {
            <i
              class="bwi bwi-spinner bwi-spin tw-text-muted"
              aria-hidden="true"
              title="{{ 'loading' | i18n }}"
            ></i>
          } @else {
            <span>{{ row.memberCount | number }}</span>
          }
        </td>

        <!-- Status -->
        <td bitCell class="tw-text-center">
          @if (row.status === null) {
            <i
              class="bwi bwi-spinner bwi-spin tw-text-muted"
              aria-hidden="true"
              title="{{ 'loading' | i18n }}"
            ></i>
          } @else if (row.status === RiskInsightsItemStatus.AtRisk) {
            <span bitBadge variant="danger">{{ "atRisk" | i18n }}</span>
          } @else {
            <span bitBadge variant="success">{{ "healthy" | i18n }}</span>
          }
        </td>
      </ng-template>
    </bit-table-scroll>
  } @else if (processingPhase() === ProcessingPhase.Error) {
    <!-- Error State -->
    <div class="tw-text-center tw-py-8 tw-text-danger-600">
      <i class="bwi bwi-error tw-text-4xl tw-mb-4" aria-hidden="true"></i>
      <p>{{ "errorOccurred" | i18n }}</p>
      @if (error()) {
        <p class="tw-text-sm tw-text-muted tw-mt-2">{{ error() }}</p>
      }
    </div>
  } @else if (processingPhase() === ProcessingPhase.Idle) {
    <!-- Initial State -->
    <div class="tw-text-center tw-py-8 tw-text-muted">
      <i class="bwi bwi-report tw-text-4xl tw-mb-4" aria-hidden="true"></i>
      <p>{{ "riskInsightsPrototypeItemsPlaceholder" | i18n }}</p>
    </div>
  }
</div>
