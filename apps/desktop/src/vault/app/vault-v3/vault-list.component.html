<cdk-virtual-scroll-viewport [itemSize]="RowHeight" bitScrollLayout class="tw-pb-8">
  <app-header [title]="'vault' | i18n">
    <vault-new-cipher-menu
      [canCreateCipher]="true"
      [canCreateFolder]="true"
      [canCreateSshKey]="true"
      [canCreateCollection]="canCreateCollections()"
      (cipherAdded)="addCipher($event)"
      (folderAdded)="addFolder()"
      (collectionAdded)="addCollection()"
    />
  </app-header>
  <div class="tw-mb-[16px]">
    <app-search />
  </div>
  <bit-table [dataSource]="dataSource" layout="fixed">
    <ng-container header>
      <tr>
        <!-- Individual or Organization vault -->
        <th
          bitCell
          bitSortable="name"
          [fn]="sortByName"
          [class]="showExtraColumn ? 'tw-w-3/6' : 'tw-w-full'"
        >
          {{ "name" | i18n }}
        </th>
        @if (showOwner()) {
          <th
            bitCell
            bitSortable="owner"
            [fn]="sortByOwner"
            class="tw-hidden tw-w-2/6 lg:tw-table-cell"
          >
            {{ "owner" | i18n }}
          </th>
        }
        <th bitCell class="tw-hidden tw-w-1/6 lg:tw-table-cell tw-text-right tw-font-medium">
          {{ "options" | i18n }}
        </th>
      </tr>
    </ng-container>
    <ng-template body let-rows$>
      <ng-container *cdkVirtualFor="let item of rows$; templateCacheSize: 0">
        @if (item.collection) {
          <tr
            bitRow
            appVaultCollectionRow
            alignContent="middle"
            [disabled]="disabled()"
            [collection]="item.collection"
            [showOwner]="showOwner()"
            [organizations]="allOrganizations()"
            [showPermissionsColumn]="showPermissionsColumn()"
            [groups]="allGroups()"
            [canDeleteCollection]="canDeleteCollection(item.collection)"
            [canEditCollection]="canEditCollection(item.collection)"
            [canViewCollectionInfo]="canViewCollectionInfo(item.collection)"
            [checked]="selection.isSelected(item)"
            (checkedToggled)="selection.toggle(item)"
            (onEvent)="event($event)"
          ></tr>
        }
        <!--
          addAccessStatus check here so ciphers do not show if user
          has filtered for collections with addAccess
        -->
        @if (
          item.cipher && (!addAccessToggle() || (addAccessToggle() && addAccessStatus() !== 1))
        ) {
          <tr
            bitRow
            appVaultCipherRow
            alignContent="middle"
            [disabled]="disabled()"
            [cipher]="item.cipher"
            [showOwner]="showOwner()"
            [showPremiumFeatures]="showPremiumFeatures()"
            [useEvents]="useEvents()"
            [viewingOrgVault]="viewingOrgVault()"
            [cloneable]="canClone$(item) | async"
            [organizations]="allOrganizations()"
            [collections]="allCollections()"
            [checked]="selection.isSelected(item)"
            [canEditCipher]="canEditCipher(item.cipher)"
            [canAssignCollections]="canAssignCollections(item.cipher)"
            [canManageCollection]="canManageCollection(item.cipher)"
            [canDeleteCipher]="
              cipherAuthorizationService.canDeleteCipher$(item.cipher, showAdminActions()) | async
            "
            [canRestoreCipher]="
              cipherAuthorizationService.canRestoreCipher$(item.cipher, showAdminActions()) | async
            "
            (checkedToggled)="selection.toggle(item)"
            (onEvent)="event($event)"
            [userCanArchive]="userCanArchive()"
            [enforceOrgDataOwnershipPolicy]="enforceOrgDataOwnershipPolicy()"
            [archiveEnabled]="archiveFeatureEnabled$ | async"
          ></tr>
        }
      </ng-container>
    </ng-template>
  </bit-table>
</cdk-virtual-scroll-viewport>
