@let passwordManager = this.passwordManager();
@let additionalStorage = this.additionalStorage();
@let secretsManager = this.secretsManager();
@let additionalServiceAccounts = this.secretsManager()?.additionalServiceAccounts;

<div class="tw-size-full">
  <div class="tw-flex tw-items-center tw-pb-4">
    <div class="tw-flex tw-items-center">
      <h2 bitTypography="h4" id="purchase-summary-heading" class="!tw-m-0">
        {{ "Total" | i18n }}: {{ total() | currency: "USD" : "symbol" }} USD
      </h2>
      <span bitTypography="h3">&nbsp;</span>
      <span bitTypography="body1" class="tw-text-main">/ {{ passwordManager.cadence | i18n }}</span>
    </div>
    <button
      type="button"
      size="small"
      (click)="toggleExpanded()"
      [bitIconButton]="isExpanded() ? 'bwi-angle-up' : 'bwi-angle-down'"
      [label]="isExpanded() ? 'Collapse purchase details' : 'Expand purchase details'"
      [attr.aria-expanded]="isExpanded()"
      [attr.aria-controls]="'purchase-summary-details'"
    ></button>
  </div>

  @if (isExpanded()) {
    <div id="purchase-summary-details" class="tw-pb-2">
      <!-- Password Manager Section -->
      <div class="tw-border-b tw-border-secondary-100 tw-pb-2">
        <div class="tw-flex tw-justify-between tw-mb-1">
          <h3 bitTypography="h5" class="tw-text-muted">{{ "Password Manager" | i18n }}</h3>
        </div>

        <!-- Password Manager Members -->
        <div class="tw-flex tw-justify-between">
          <div class="tw-flex-1">
            <div bitTypography="body1" class="tw-text-muted">
              {{ passwordManager.quantity }} {{ passwordManager.name | i18n }} x
              {{ passwordManager.cost | currency: "USD" : "symbol" }}
              /
              {{ passwordManager.cadence | i18n }}
            </div>
          </div>
          <div bitTypography="body1" class="tw-text-muted">
            {{ passwordManagerTotal() | currency: "USD" : "symbol" }}
          </div>
        </div>

        <!-- Additional Storage -->
        @if (additionalStorage) {
          <div class="tw-flex tw-justify-between">
            <div class="tw-flex-1">
              <div bitTypography="body1" class="tw-text-muted">
                {{ additionalStorage.quantity }} {{ additionalStorage.name | i18n }} x
                {{ additionalStorage.cost | currency: "USD" : "symbol" }} /
                {{ additionalStorage.cadence | i18n }}
              </div>
            </div>
            <div bitTypography="body1" class="tw-text-muted">
              {{ additionalStorageTotal() | currency: "USD" : "symbol" }}
            </div>
          </div>
        }
      </div>

      <!-- Secrets Manager Section -->
      @if (secretsManager) {
        <div class="tw-border-b tw-border-secondary-100 tw-py-2">
          <div class="tw-flex tw-justify-between">
            <h3 bitTypography="h5" class="tw-text-muted">{{ "Secrets Manager" | i18n }}</h3>
          </div>

          <!-- Secrets Manager Members -->
          <div class="tw-flex tw-justify-between">
            <div bitTypography="body1" class="tw-text-muted">
              {{ secretsManager.seats.quantity }} {{ secretsManager.seats.name | i18n }} x
              {{ secretsManager.seats.cost | currency: "USD" : "symbol" }}
              / {{ secretsManager.seats.cadence | i18n }}
            </div>
            <div bitTypography="body1" class="tw-text-muted">
              {{ secretsManagerSeatsTotal() | currency: "USD" : "symbol" }}
            </div>
          </div>

          <!-- Additional Service Accounts -->
          @if (additionalServiceAccounts) {
            <div class="tw-flex tw-justify-between">
              <div bitTypography="body1" class="tw-text-muted">
                {{ additionalServiceAccounts.quantity }}
                {{ additionalServiceAccounts.name | i18n }} x
                {{ additionalServiceAccounts.cost | currency: "USD" : "symbol" }}
                /
                {{ additionalServiceAccounts.cadence | i18n }}
              </div>
              <div bitTypography="body1" class="tw-text-muted">
                {{ additionalServiceAccountsTotal() | currency: "USD" : "symbol" }}
              </div>
            </div>
          }
        </div>
      }

      <!-- Estimated Tax -->
      <div class="tw-flex tw-justify-between tw-border-b tw-border-secondary-100 tw-pt-2 tw-pb-0.5">
        <h3 bitTypography="h5" class="tw-text-muted">{{ "Estimated tax" | i18n }}</h3>
        <div bitTypography="body1" class="tw-text-muted">
          {{ estimatedTax() | currency: "USD" : "symbol" }}
        </div>
      </div>

      <!-- Total -->
      <div class="tw-flex tw-justify-between tw-items-center tw-pt-2">
        <h3 bitTypography="h5" class="tw-text-muted">{{ "Total" | i18n }}</h3>
        <div bitTypography="body1" class="tw-text-muted">
          {{ total() | currency: "USD" : "symbol" }} / {{ passwordManager.cadence | i18n }}
        </div>
      </div>
    </div>
  }
</div>
